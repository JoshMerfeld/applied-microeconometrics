---
title:  |
    | Microeconometrics (Causal Inference)
    | Week 5 - Differences-in-differences I
author:
  |
    | Joshua D. Merfeld
    | KDI School of Public Policy and Management
date: "`r Sys.Date()`"

# Output type and options
output: 
  beamer_presentation:
    theme: Montpellier
classoption: "aspectratio=169"

# This includes latex arguments
header-includes:
  - \AtBeginDocument{\title[Week 5 - DiD I]{Microeconometrics (Causal Inference) \\ Week 5 - Differences-in-differences I}}
  - \AtBeginDocument{\author[Josh Merfeld - KDI School]{Joshua D. Merfeld \\ KDI School of Public Policy and Management}}
  - \input{header.tex}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, dev = "png") # NOTE: switched to png instead of pdf to decrease size of the resulting pdf

def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  #ifelse(options$size != "a", paste0("\n \\", "tiny","\n\n", x, "\n\n \\normalsize"), x)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})




library(tidyverse)
library(kableExtra)
library(fixest)
library(ggpubr)
library(RColorBrewer)
library(haven)
library(mfx)
library(nnet)
library(survival)
library(survminer)
library(medicaldata)
  
licresults <- feols(pacu30min_throatPain ~ treat, data = licorice_gargle)

```



# Introduction

## What are we doing today?
\vfill





# Differences-in-differences



## Differences-in-differences

- More commonly referred to as "DID" or "diff-in-diff"
  - Classic reference: Card and Krueger (1994)

- Most common method, likely because data requirements are least stringent

- Example in _Mostly Harmless_: offering credit to banks during the Great Depression (Richardson and Troost, 2009)
  - Set up: Two different federal reserve banks lent to neighborhood banks in Mississippi
  - Atlanta fed favored lending to banks in trouble
  - St. Louis fed favored the exact opposite





## Richardson and Troost (2009) - Mississippi dividing line
\vspace{-1mm}
\center
	\includegraphics[width=0.45\columnwidth]{assets/mississippi1}





## Did the policy of extra lending save banks?

- Basic idea: compare what happened to Atlanta fed banks (southern Mississippi) with St. Louis fed banks (northern Mississippi)

- Could compare after lending, but what's the assumption here? \pause

- Assumption: same levels before intervention (very strict assumption)





## In fact, pre-intervention levels are different!

\center
	\includegraphics[width=\columnwidth]{assets/mississippi4}





## Did the policy of extra lending save banks?

- Instead, compare _changes_ from before to after treatment

- Assumption: parallel trends

- If valid, the fact the districts were different prior to the treatment isn't a problem





## "Parallel trends"
\vspace{-2mm}
\center
	\includegraphics[width=0.55\columnwidth]{assets/dd2}





## Why is it "differences in differences"?

- Difference 1: St. Louis post minus St. Louis pre

- Difference 2: Atlanta post minus Atlanta pre

- Difference-in-differences: Difference 2 minus difference 1





## "Differences in differences" graphically
\vspace{-1mm}
\center
	\includegraphics[width=0.55\columnwidth]{assets/dd1}





## Parallel trends assumption

- The key assumption in differences-in-differences is the parallel trends assumption
  - _If the treated group had not been treated, it would have changed by the same amount ("had the same trend") as the comparison group._

- This is a counterfactual assumption: We cannot explicitly test it

- What can we do instead? \pause
  - We can test trends _before_ treatment
  - Or in the case of this article, _after_ treatment!





## Richardson and Troost (2009) - Testing the assumption

\center
	\includegraphics[width=0.7\columnwidth]{assets/mississippi2}





## Estimating diff-in-diff empirically

- Can be estimated in a straightforward regression:
\begin{gather} Y_{it} = \beta_0 + \beta_1 TREAT_i + \beta_2 POST_t + \beta_3 (POST_t \times TREAT_i) + \varepsilon_{it} \end{gather}
\pause
  - $\beta_0$: pre mean for the comparison group
  - $\beta_1$: difference in the pre mean between the treated and untreated group
  - $\beta_2$: difference in means between the pre and post period for the comparison group
  - $\beta_3$: difference-in-differences estimate
    - This is the difference in the change from pre to post for the treated group relative to the comparison group





## Estimating diff-in-diff empirically - adding controls

- Can add control variables
\begin{gather} Y_{it} = \beta_0 + \beta_1 TREAT_i + \beta_2 POST_t + \\
                \beta_3 (POST_t \times TREAT_i) + X_{it} + \varepsilon_{it} \end{gather}

- Adding controls can help control for differing trends ("conditional" parallel trends)

- Note: the interpretation of $\beta_0$ is no longer the same; others stay the same





